<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>

  <head>
    <meta charset="utf-8">
      <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
      <title>Loading </title>
      <meta name="viewport" content="width=device-width">
      <meta name="title" content="Loading ">
    
    
      <link rel="shortcut icon" href="../../favicon.ico">
      <link rel="stylesheet" href="../../styles/docfx.vendor.min.css">
      <link rel="stylesheet" href="../../styles/docfx.css">
      <link rel="stylesheet" href="../../styles/main.css">
      <meta property="docfx:navrel" content="../../toc.json">
      <meta property="docfx:tocrel" content="../toc.json">
    
    
    
  </head>
  <body data-spy="scroll" data-target="#affix" data-offset="120">
    <div id="wrapper">
      <header>

        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>

              <a class="navbar-brand" href="../../index.html">
                <img id="logo" class="svg" src="../../logo.svg" alt="">
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>

                <ul class="nav level1 navbar-nav">
                      <li>
                          <a href="../../articles/guides.html" title="Manual">Manual</a>
                      </li>
                      <li>
                          <a href="../../api/index.html" title="Scripting API">Scripting API</a>
                      </li>
                      <li>
                          <a href="../../changelog/CHANGELOG.html" title="Changelog">Changelog</a>
                      </li>
                      <li>
                          <a href="../../license/LICENSE.html" title="License">License</a>
                      </li>
                </ul>
            </div>
          </div>
        </nav>

        <div class="subnav navbar navbar-default">
          <div class="container hide-when-search" id="breadcrumb">
            <ul class="breadcrumb">
              <li></li>
            </ul>
          </div>
        </div>
      </header>
      <div role="main" class="container body-content hide-when-search">
        <div class="sidenav hide-when-search">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show / Hide Table of Contents</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div>
              <div class="sidefilter">
                <form class="toc-filter">
                  <span class="glyphicon glyphicon-filter filter-icon"></span>
                  <input type="text" id="toc_filter_input" placeholder="Enter here to filter..." onkeypress="if(event.keyCode==13) {return false;}">
                </form>
              </div>
              <div class="sidetoc">
                <div class="toc" id="toc">

                  <ul class="nav level1">
                    <li class="">
                      <span class="expand-stub"></span>
                      <a href="../guides.html" title="Guides" class="">Guides</a>

                        <ul class="nav level2">
                          <li class="">
                            <a href="../guides/installation.html" title="Installation" class="">Installation</a>
                          </li>
                          <li class="">
                            <a href="../guides/getting_started.html" title="Getting Started" class="">Getting Started</a>
                          </li>
                          <li class="">
                            <a href="../guides/dependency_injection.html" title="Dependency Injection" class="">Dependency Injection</a>
                          </li>
                          <li class="active">
                            <a href="../guides/loading.html" title="Loading" class="active">Loading</a>
                          </li>
                          <li class="">
                            <a href="../guides/scene_changes.html" title="Scene Changes" class="">Scene Changes</a>
                          </li>
                          <li class="">
                            <a href="../guides/stateful_behaviour.html" title="Stateful Behaviour" class="">Stateful Behaviour</a>
                          </li>
                        </ul>
                    </li>
                  </ul>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="loading">
<h1 id="loading">Loading</h1>

<p>One of the key features of <strong>AlchemyBow.Core</strong> is its ability to provide an easy, organized, and efficient way to handle loading processes, as well as designated places for initialization and deinitialization.</p>
<h2 id="icoreloadable">ICoreLoadable</h2>
<p><a class="xref" href="../../api/AlchemyBow.Core.ICoreLoadable.html">ICoreLoadable</a> is an interface for objects that require a time-consuming loading process. It defines a single method, <code>Load(OperationHandle)</code>, which takes an <a class="xref" href="../../api/AlchemyBow.Core.OperationHandle.html">OperationHandle</a> as a parameter. The loading process is considered complete once you call <code>OperationHandle.MarkDone()</code>.</p>
<pre><code>using AlchemyBow.Core;
using System.Collections;
using UnityEngine;

public class SampleCoreLoadable : MonoBehaviour, ICoreLoadable
{
    void ICoreLoadable.Load(OperationHandle handle)
    {
        StartCoroutine(CreateLoadCoroutine(handle));
    }

    private IEnumerator CreateLoadCoroutine(OperationHandle handle)
    {
        // Simulate a time-consuming operation (e.g., loading resources, initializing data)
        yield return new WaitForSeconds(1);
        handle.MarkDone();
    }
}
</code></pre>
<div class="NOTE">
<h5>Note</h5>
<p>It often makes sense to use explicit interface implementation to hide the <code>Load()</code> method from the public interface of your class as it is only used by the framework.</p>
</div>
<h3 id="getting-loadables">Getting Loadables</h3>
<p>To specify <strong>what to load</strong> and <strong>in what order</strong>, override the <code>GetLoadables()</code> method in either <a class="xref" href="../../api/AlchemyBow.Core.CoreController-1.html">CoreController</a> or <a class="xref" href="../../api/AlchemyBow.Core.CoreProjectContext.html">CoreProjectContext</a>, depending on the scope to which the loadable belongs.</p>
<div class="NOTE">
<h5>Note</h5>
<p>Loadables returned by the <a class="xref" href="../../api/AlchemyBow.Core.CoreController-1.html">CoreController</a> are loaded each time you change the scene, but loadables returned by the <a class="xref" href="../../api/AlchemyBow.Core.CoreProjectContext.html">CoreProjectContext</a> are only loaded once.</p>
</div>
<p>There are several ways to get your loadables. One efficient method is to use dependency injection directly, as shown in the example below:</p>
<pre><code>using AlchemyBow.Core;
using AlchemyBow.Core.IoC;
using System.Collections.Generic;

[InjectionTarget]
public class MyCoreProjectContext : CoreProjectContext
{
    [Inject]
    private readonly SampleCoreLoadable sampleCoreLoadable;

    protected override IEnumerable&lt;ICoreLoadable&gt; GetLoadables()
    {
        yield return sampleCoreLoadable;
        yield break;
    }
}
</code></pre>
<p>This solution is very convenient as it allows you explicitly define the loadables and their order.</p>
<div class="TIP">
<h5>Tip</h5>
<p>As your project grows, you may want to consider delegating the task of managing loadables to other objects to prevent controllers from becoming overly large and tightly coupled with specific loadables, which can reduce maintainability.</p>
</div>
<p>Another interesting approach is to leverage the dynamic collection binding feature. You can add your loadables to a collection using installers and then use that collection in the <code>GetLoadables()</code> method. This approach can be even more effective if combined with a sorted or prioritized collection, still allowing you to control the loading order.</p>
<h3 id="loading-progress">Loading Progress</h3>
<p>You can track the progress of the loading process and react to it (e.g., by updating your loading screen). To do this, override the <code>CoreController.OnLoadablesProgressed(LoadablesProgress)</code> method:</p>
<pre><code>using AlchemyBow.Core;
using AlchemyBow.Core.IoC;
using System.Collections.Generic;

[InjectionTarget]
public class MyCoreController : CoreController&lt;CoreProjectContext&gt;
{
    protected override IEnumerable&lt;ICoreLoadable&gt; GetLoadables()
    {
        // Return your loadables here
    }

    protected override void OnLoadablesProgressed(LoadablesProgress progress)
    {
        UnityEngine.Debug.Log($&quot;{progress.loadableIndex}/{progress.numberOfLoadables}---{progress.loadable}:{progress.loadableCompleted}&quot;);
    }
}
</code></pre>
<div class="NOTE">
<h5>Note</h5>
<p>This method is called twice for each loadable — once when the loading starts, and again when it's completed.</p>
</div>
<div class="NOTE">
<h5>Note</h5>
<p>If project context loadables haven’t been loaded previously, they will also be included in the progress.</p>
</div>
<h2 id="icoreloadingcallbackshandler">ICoreLoadingCallbacksHandler</h2>
<p>The <a class="xref" href="../../api/AlchemyBow.Core.ICoreLoadingCallbacksHandler.html">ICoreLoadingCallbacksHandler</a> provides a mechanism for notifying objects when the <a class="xref" href="../../api/AlchemyBow.Core.CoreController-1.html">CoreController</a> has finished loading or started unloading.</p>
<pre><code>using AlchemyBow.Core;

public class SampleCoreLoadingCallbacksHandler : ICoreLoadingCallbacksHandler
{
    public void OnCoreLoadingFinished()
    {
        // For example:
        // - Load some data
        // - Subscribe to events
    }

    public void OnCoreSceneChangeStarted()
    {
        // For example:
        // - Unsubscribe from events
    }
}
</code></pre>
<p>To receive the callbacks, add subscribers to the dynamic <code>List&lt;ICoreLoadingCallbacksHandler&gt;</code> binding:</p>
<pre><code>using AlchemyBow.Core;
using AlchemyBow.Core.Extras.FluentBindings;
using AlchemyBow.Core.IoC;
using System.Collections.Generic;

public class SampleMonoInstaller : MonoInstaller
{
    public override void InstallBindings(IBindOnlyContainer container)
    {
        var sample = new SampleCoreLoadingCallbacksHandler();
        container.Bind(sample);
        
        // Add to the dynamic collection binding
        container.AddToDynamicCollectionBinding&lt;List&lt;ICoreLoadingCallbacksHandler&gt;, ICoreLoadingCallbacksHandler&gt;(sample);
        
        // Or use the shortcut:
        // container.AddToDynamicListBinding&lt;ICoreLoadingCallbacksHandler&gt;(sample);
        
        // Alternatively, with fluent syntax:
        // container.StartFluentBinding(new SampleCoreLoadingCallbacksHandler())
        //     .BindToSelf()
        //     .AddToCoreLoadingCallbacksHandlers();
    }
}
</code></pre>
<div class="WARNING">
<h5>Warning</h5>
<p><a class="xref" href="../../api/AlchemyBow.Core.ICoreLoadingCallbacksHandler.html">ICoreLoadingCallbacksHandler</a> cannot be used in the project context.</p>
</div>
<h2 id="corebehaviour">CoreBehaviour</h2>
<p><a class="xref" href="../../api/AlchemyBow.Core.Extras.Behaviours.CoreBehaviour.html">CoreBehaviour</a> serves as a base class for plain C# objects that can be enabled or disabled  based on the <a class="xref" href="../../api/AlchemyBow.Core.Extras.Behaviours.CoreBehaviourEnablingStrategy.html">CoreBehaviourEnablingStrategy</a> you select. It's built on top of core loading callbacks allowing easy initialization or cleanup.</p>
<pre><code>using AlchemyBow.Core.Extras.Behaviours;
using AlchemyBow.Core.IoC;
using UnityEngine;

public class MyCoreBehaviour : CoreBehaviour
{
    // The strategy is set via the constructor
    public MyCoreBehaviour() 
        : base(CoreBehaviourEnablingStrategy.SimpleAutoEnableDisable)
    {
    }
    
    // You can safely override any of these methods:
    
    protected override void OnCoreLoadingFinished()
    {
        // Initialization logic
    }
    
    protected override void OnCoreSceneChangeStarted()
    {
        // Cleanup logic
    }

    protected override void OnEnabled()
    {
        // Logic executed when enabled
    }
    
    protected override void OnDisabled()
    {
        // Logic executed when disabled
    }
}
</code></pre>
<p>Since <a class="xref" href="../../api/AlchemyBow.Core.Extras.Behaviours.CoreBehaviour.html">CoreBehaviour</a> implements <a class="xref" href="../../api/AlchemyBow.Core.ICoreLoadingCallbacksHandler.html">ICoreLoadingCallbacksHandler</a>, it also must be added to the dynamic list binding of <a class="xref" href="../../api/AlchemyBow.Core.ICoreLoadingCallbacksHandler.html">ICoreLoadingCallbacksHandler</a> to receive callbacks.</p>
<pre><code>using AlchemyBow.Core;
using AlchemyBow.Core.Extras.FluentBindings;
using AlchemyBow.Core.IoC;
using System.Collections.Generic;

public class MyCoreBehaviourMonoInstaller : MonoInstaller
{
    public override void InstallBindings(IBindOnlyContainer container)
    {
        container.StartFluentBinding(new MyCoreBehaviour())
            .BindToSelf()
            .AddToCoreLoadingCallbacksHandlers();
    }
}
</code></pre>

</article>
          </div>

          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <div class="contribution">
                <ul class="nav">
                </ul>
              </div>
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
                <h5>In this article</h5>
                <div></div>
              </nav>
            </div>
          </div>
        </div>
      </div>

      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
      <span>Copyright © 2022-2024 <a href="https://www.alchemybow.com/"><b>AlchemyBow</b></a></span> | <span>Generated by <b>DocFX</b></span>
      
          </div>
        </div>
      </footer>
    </div>

    <script type="text/javascript" src="../../styles/docfx.vendor.min.js"></script>
    <script type="text/javascript" src="../../styles/docfx.js"></script>
    <script type="text/javascript" src="../../styles/main.js"></script>
  </body>
</html>
